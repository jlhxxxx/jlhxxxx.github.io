<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="author" content="Aman" />
    <meta name="robots" content="index, follow"/>
	<meta name="baidu-site-verification" content="maDdvat0eq" />

    <meta property="og:title" content="Oracle 十全大补汤"/>
    <meta property="og:url" content="https://jlhxxxx.github.io/oracle-rudiment.html"/>
    <meta property="og:site_name" content="AMAN's BLOG"/>
    <meta property="og:type" content="article"/>

    <link rel="canonical" href="https://jlhxxxx.github.io/oracle-rudiment.html" />

    <title>Oracle 十全大补汤 | AMAN's BLOG</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" />
    <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" />

    <link rel="stylesheet" type="text/css" href="https://jlhxxxx.github.io/theme/css/main.css" />
    <link href="https://jlhxxxx.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="AMAN's BLOG Atom Feed" />

    <script type="text/javascript">var switchTo5x=true;</script>
    <script type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script>
    <script type="text/javascript">
        stLight.options({
            publisher: "",
            doNotHash: false,
            doNotCopy: false,
            hashAddressBar: false
        });
    </script>
</head>

<body id="index">
<a class="hidden-phone" href="https://github.com/jlhxxxx/jlhxxxx.github.io">
<img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub" />
</a>
    <div class="row-fluid">
        <div class="span10 offset1">
            <header id="banner" >
                <h1>
                    <a href="https://jlhxxxx.github.io/">AMAN's BLOG </a>
                </h1>
                <nav class="navbar">
                    <div class="navbar-inner">
                        <ul class="nav">
                            <li ><a href="https://jlhxxxx.github.io/category/software.html">Software</a></li>
                            <li class="active"><a href="https://jlhxxxx.github.io/category/sql.html">SQL</a></li>
                            <li ><a href="https://jlhxxxx.github.io/category/test-tools.html">Test Tools</a></li>
                        </ul>
<script>
  (function() {
    var cx = '000342699563853547877:_ntl2s92dby';
    var gcse = document.createElement('script'); gcse.type = 'text/javascript'; gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//www.google.com/cse/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(gcse, s);
  })();
</script>
<div id="google-custom-search" class="nav">
    <gcse:search></gcse:search>
</div>
                    </div>
                </nav>
            </header><!-- /#banner -->
        </div>
    </div>

    <div class="row-fluid">
        <div class="span10 offset1">
            <div class="row-fluid">
<div class="span10 offset1">
  <section>
    <article>
      <header>
        <h1 class="entry-title">
          <a href="https://jlhxxxx.github.io/oracle-rudiment.html" rel="bookmark"
             title="Permalink to Oracle 十全大补汤">Oracle 十全大补汤</a></h1>
      </header>
      <div class="entry-content">
<footer class="post-info">
    <address class="vcard author">
        by <a class="url fn" href="https://jlhxxxx.github.io/author/aman.html">Aman</a>
    </address>

    in <a href="https://jlhxxxx.github.io/category/sql.html">SQL</a>

    on 2018-05-12

        |
        tags:         <a href="https://jlhxxxx.github.io/tag/oracle.html">Oracle</a>
        <a href="https://jlhxxxx.github.io/tag/rudiment.html">Rudiment</a>



    
</footer><!-- /.post-info -->

        <h2 id="_1">安装卸载</h2>
<h4 id="_2">安装</h4>
<p>新手不建议安装发布不久的最新版本，一来新版本可能有一些新特性，但是网上相关的文章较少，入坑概率很大，老手尚需时间来适应，新手肯定更觉得难以上手了；二来旧版本相对比较稳定，各种文档丰富，常见BUG都有比较成熟的应对方法；三是要看使用环境了，兼容性是考虑重点，客户端和服务器端版本要尽量一致，这里的问题实在太多，几百M都讲不完，说多了都是眼泪。</p>
<p>Oracle下载地址：<a href="http://www.oracle.com/technetwork/database/enterprise-edition/downloads/index.html">【英文地址】</a>、<a href="http://www.oracle.com/technetwork/cn/database/enterprise-edition/downloads/index.html">【中文地址】</a></p>
<p><strong>Windows下安装教程</strong>：<a href="https://blog.csdn.net/anxpp/article/details/51345074"> Oracle 12c Windows安装、介绍及简单使用(图文) </a></p>
<ul>
<li>网上这个教程以Oracle 12c为例，其他版本安装过程都差不多，注意<strong>安装位置</strong>自己设置一下（只要设置Oracle基目录即可，其他目录会相应改变），<strong>字符集选UTF-8</strong>。</li>
</ul>
<p><strong>Linux下安装教程</strong>：todo</p>
<p><strong>安装过程中出现的问题</strong></p>
<ul>
<li>
<p><a href="https://blog.csdn.net/qq_33530388/article/details/56669466">win10 下安装Oracle 11g(问题：环境不满足最低要求) </a></p>
</li>
<li>
<p>先决条件检查有失败内容</p>
<p>查看失败内容，如果是“预期值：N/A，实际值：N/A”这样的，是因为操作系统未开启默认共享，导致Oracle无法检查环境的可用性 ，这种情况直接点击右上角的全部忽略，就可以进行下一步安装了；如果确实某方面配置不达标，就不建议继续安装了，装个PL/SQL连服务器上的库玩就好了。</p>
</li>
</ul>
<h4 id="_3">卸载</h4>
<p>新手导错库或者初始化配置错误不知道还原的方法怎么办，简单，卸载重装。^_^ 装装卸卸多了，就变成熟手了。这个有现成的教程，亲测好用：</p>
<p><strong>Windows下卸载</strong>：<a href="https://blog.csdn.net/Devin_LiuYM/article/details/59539020">彻底的卸载干净oracle 11g</a></p>
<p><strong>Linux下卸载</strong>：todo</p>
<h2 id="_4">常用目录结构</h2>
<p>了解Oracle常用目录结构，将大大提高数据库管理与维护的工作效率 。这里以oracle 11g为例。</p>
<div class="highlight"><pre><span></span>.                                   # 主目录
│─ cfgtoollogs                       # 存放当运行dbca，dbua，emca，netca等图形化配置程序时的log
│─ flash_recovery_area                  # 存储并管理与备份和恢复有关的文件
│─ oradata                              # 数据库文件缺省存储目录
│   │─ dbf文件                        # 对应数据库中每个表空间
│   │─ ctl文件                          # 控制文件
│   └─ log文件                          # 对应重做日志文件组及其成员
└─ product                              # 客户端主目录
    └─ 11.2.0\dbhome_1
            │─ bin                  # 主要包含用于数据库管理的各种命令
            │─ css                  # 与Oracle Cluster Synchronization服务有关的文件
            │─ database
            │   └─ SPFILEORCL.ORA   # 服务器参数文件
            │─ dbs                    # 存放数据库服务器端的参数文件Spfile
            │─ demo                   # 存放数据库实例模式的脚本等
            │─ install              # 用于存储ORACLE安装后的端口号,iSQL*Plus以及Enterprise Manager Database Control启动并登录的方式等,如该路径下的portlist.ini
            │─ network/admin            # 有关监听器listener.ora和sqlnet.ora以及tnsnames.ora等
            └─ sysman/config            # 用于与Oracle Enterprise Management有关的端口管理等
                └─emkey.ora         # 加密密钥
</pre></div>


<ul>
<li><a href="https://blog.csdn.net/leshami/article/details/5633093">Oracle 常用目录结构(10g) </a></li>
</ul>
<h2 id="_5">监听/别名配置</h2>
<p>Oracle只有在<strong>服务器端配置监听是必须</strong>的，在<strong>客户端可以不用配置</strong>；而且一般服务器端都是监听本地，默认配置都有，不需要另外配置；只有监听其他地址才需要另外配置。网上很多配置监听的教程都是修改\oracle\product\11.2.0\dbhome_1\NETWORK\ADMIN\目录下tnsname.ora文件 ,其实是错误的，监听配置文件是同一目录下listener.ora文件，下面三篇文章感觉写的比较深入，但没有具体实践对比过。</p>
<ul>
<li><a href="https://blog.csdn.net/nixiangxiren/article/details/6293880">oracle监听器配置</a></li>
<li><a href="https://blog.csdn.net/scofy0/article/details/49069217">Oracle监听配置详解</a></li>
<li><a href="http://www.cnblogs.com/wanghongyun/p/6307548.html">Oracle的tnsnames.ora 监听配置文件详解</a></li>
</ul>
<p>那么tnsname.ora文件是做什么用的呢，其实这是<strong>别名配置文件</strong>，类似于hosts文件，提供tnsname到主机名或者ip的对应。</p>
<p>配置监听和别名的格式是一样的，添加如下：</p>
<div class="highlight"><pre><span></span><span class="n">TEST</span> <span class="o">=</span>                                                              <span class="c1">--别名</span>
  <span class="p">(</span><span class="n">DESCRIPTION</span> <span class="o">=</span>
    <span class="p">(</span><span class="n">ADDRESS</span> <span class="o">=</span> <span class="p">(</span><span class="n">PROTOCOL</span> <span class="o">=</span> <span class="n">TCP</span><span class="p">)(</span><span class="k">HOST</span> <span class="o">=</span> <span class="mi">192</span><span class="p">.</span><span class="mi">168</span><span class="p">.</span><span class="mi">1</span><span class="p">.</span><span class="mi">1</span> <span class="p">)(</span><span class="n">PORT</span> <span class="o">=</span> <span class="mi">1521</span><span class="p">))</span>  <span class="c1">--地址及端口号</span>
    <span class="p">(</span><span class="n">CONNECT_DATA</span> <span class="o">=</span>
      <span class="p">(</span><span class="n">SERVICE_NAME</span> <span class="o">=</span> <span class="n">orcl</span><span class="p">)</span>                                         <span class="c1">--实例名称</span>
    <span class="p">)</span>
  <span class="p">)</span>
</pre></div>


<h2 id="cmd">cmd命令</h2>
<p>前提是本地安装了Oracle客户端，打开cmd，输入命令。由于帮助文档是中文的，所以不展开。</p>
<ul>
<li>
<p><code>tnsping</code>：诊断连接，查看帮助<code>tnsping</code>，地址可以使用别名。</p>
</li>
<li>
<p><code>exp</code>：导出，查看帮助<code>EXP HELP=Y</code>，具体参见数据库迁移内容。</p>
</li>
<li>
<p><code>imp</code>：导入，查看帮助<code>IMP HELP=Y</code>，具体参见数据库迁移内容。</p>
</li>
<li>
<p><code>sqlplus</code>：链接，查看版本及帮助<code>sqlplus -H</code>。链接成功后命令提示符变成<code>SQL&gt;</code>，此后可以输入正常SQL语句，记得句末带<code>;</code>，正常退出使用<code>quit</code>，其他输错密码或陷入不可描述状态退出可使用<code>Ctrl+C</code>，或者直接关闭终端。</p>
</li>
</ul>
<p>其他命令还有很多，都在\oracle\product\11.2.0\dbhome_1\BIN\目录下，Windows下可执行命令为exe文件。</p>
<h2 id="_6">数据库初始化</h2>
<p>数据库初始化主要分三步：创建表空间，建立用户和用户授权。</p>
<h4 id="_7">创建表空间</h4>
<p>在创建表空间之前，首先要知道什么是表空间，并且要清楚临时表空间、永久表空间、默认表空间、UNDO表空间之间的区别，这里有几篇文章可以好好看下：</p>
<ul>
<li>
<p><a href="https://blog.csdn.net/leshami/article/details/5611738">Oracle 表空间与数据文件</a></p>
</li>
<li>
<p><a href="http://www.cnblogs.com/fnng/archive/2012/08/12/2634485.html">Oracle表空间（tablespaces）</a></p>
</li>
<li>
<p><a href="https://blog.csdn.net/jmilk/article/details/51599260">Oracle 表空间详解</a></p>
</li>
<li>
<p><a href="https://www.cnblogs.com/zhangyingai/p/7082594.html">临时表空间概念</a></p>
<blockquote>
<p>这里需要注意的是，若数据库没有临时表空间，在创建正式表空间之前，应先建一个临时表空间。</p>
</blockquote>
</li>
</ul>
<p>概念掌握之后，在实际创建表空间之前，最好先查询一下，确保要使用的名称没有被使用：</p>
<div class="highlight"><pre><span></span><span class="c1">--查看已有的表空间</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">v$tablespace</span><span class="p">;</span>

<span class="c1">--查看详细数据文件</span>
<span class="k">SELECT</span> <span class="n">file_name</span><span class="p">,</span><span class="n">tablespace_name</span> <span class="k">FROM</span> <span class="n">dba_data_files</span><span class="p">;</span>

<span class="c1">--查看表空间使用情况</span>
<span class="k">SELECT</span> <span class="n">A</span><span class="p">.</span><span class="n">TABLESPACE_NAME</span>                     <span class="k">AS</span> <span class="n">TABLESPACE_NAME</span><span class="p">,</span> 
        <span class="n">ROUND</span><span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="n">BYTES</span><span class="o">/</span><span class="p">(</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span>    <span class="k">AS</span> <span class="ss">&quot;TOTAL(G)&quot;</span>     <span class="p">,</span> 
        <span class="n">ROUND</span><span class="p">(</span><span class="n">B</span><span class="p">.</span><span class="n">BYTES</span><span class="o">/</span><span class="p">(</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span>    <span class="k">AS</span> <span class="ss">&quot;USED(G)&quot;</span>      <span class="p">,</span> 
        <span class="n">ROUND</span><span class="p">(</span><span class="k">C</span><span class="p">.</span><span class="n">BYTES</span><span class="o">/</span><span class="p">(</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span>    <span class="k">AS</span> <span class="ss">&quot;FREE(G)&quot;</span>      <span class="p">,</span> 
        <span class="n">ROUND</span><span class="p">((</span><span class="n">B</span><span class="p">.</span><span class="n">BYTES</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span> <span class="o">/</span> <span class="n">A</span><span class="p">.</span><span class="n">BYTES</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>   <span class="k">AS</span> <span class="ss">&quot;% USED&quot;</span>       <span class="p">,</span> 
        <span class="n">ROUND</span><span class="p">((</span><span class="k">C</span><span class="p">.</span><span class="n">BYTES</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span> <span class="o">/</span> <span class="n">A</span><span class="p">.</span><span class="n">BYTES</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>   <span class="k">AS</span> <span class="ss">&quot;% FREE&quot;</span> 
<span class="k">FROM</span> <span class="n">SYS</span><span class="p">.</span><span class="n">SM$TS_AVAIL</span> <span class="n">A</span><span class="p">,</span> <span class="n">SYS</span><span class="p">.</span><span class="n">SM$TS_USED</span> <span class="n">B</span><span class="p">,</span> <span class="n">SYS</span><span class="p">.</span><span class="n">SM$TS_FREE</span> <span class="k">C</span> 
<span class="k">WHERE</span> <span class="n">A</span><span class="p">.</span><span class="n">TABLESPACE_NAME</span> <span class="o">=</span> <span class="n">B</span><span class="p">.</span><span class="n">TABLESPACE_NAME</span> 
<span class="k">AND</span> <span class="n">A</span><span class="p">.</span><span class="n">TABLESPACE_NAME</span> <span class="o">=</span> <span class="k">C</span><span class="p">.</span><span class="n">TABLESPACE_NAME</span><span class="p">;</span>
</pre></div>


<p>要创建表空间，首先要使用有CREATE  TABLESPACE权限的用户，<strong>创建表空间语法</strong>如下：</p>
<div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="p">[</span><span class="n">BIGFILE</span> <span class="o">|</span> <span class="n">SMALLFILE</span><span class="p">]</span> <span class="p">[</span><span class="k">TEMPORARY</span><span class="p">]</span> <span class="n">TABLESPACE</span> <span class="n">tablespace_name</span>
<span class="n">DATAFILE</span> <span class="n">datafile</span> <span class="n">spec</span> <span class="o">|</span> <span class="n">TEMPFILE</span> <span class="n">tempfile</span> <span class="n">spec</span>
<span class="p">[</span><span class="n">MINIMUM</span> <span class="n">EXTENT</span> <span class="n">minimum</span> <span class="n">extent</span> <span class="k">size</span><span class="p">]</span>
<span class="p">[</span><span class="n">BLOCKSIZE</span> <span class="n">blocksize</span><span class="p">]</span>
<span class="p">[[</span><span class="n">COMPRESS</span><span class="o">|</span><span class="n">NOCOMPRESS</span><span class="p">]</span> <span class="k">DEFAULT</span> <span class="k">STORAGE</span> <span class="p">(</span><span class="k">default</span> <span class="k">storage</span> <span class="n">clause</span><span class="p">)]</span>
<span class="p">[</span><span class="n">LOGGING</span><span class="o">|</span><span class="n">NOLOGGING</span><span class="p">]</span>
<span class="p">[</span><span class="k">FORCE</span> <span class="n">LOGGING</span><span class="p">]</span>
<span class="p">[</span><span class="n">ONLINE</span><span class="o">|</span><span class="n">OFFLINE</span><span class="p">]</span>
<span class="p">[</span><span class="n">EXTENT</span> <span class="n">MANAGEMENT</span> <span class="k">DICTIONARY</span><span class="o">|</span><span class="k">LOCAL</span> <span class="p">[</span><span class="n">AUTOALLOCATE</span><span class="o">|</span><span class="n">UNIFORM</span> <span class="k">SIZE</span> <span class="k">size</span><span class="p">]]</span>
<span class="p">[</span><span class="n">SEGMENT</span> <span class="k">SPACE</span> <span class="n">MANAGEMENT</span> <span class="n">MANUAL</span><span class="o">|</span><span class="n">AUTO</span><span class="p">]</span>
<span class="p">[</span><span class="n">FLASHBACK</span> <span class="k">ON</span><span class="o">|</span><span class="k">OFF</span><span class="p">]</span>
</pre></div>


<ul>
<li><a href="https://www.linuxidc.com/Linux/2016-12/138981.htm">Oracle create tablespace 创建表空间语法详解</a></li>
</ul>
<p>语法看起来有点复杂，但是实际应用中并不是每个选项都需要配置，你只需知道能配置哪些就好，下面举一些栗子：</p>
<div class="highlight"><pre><span></span><span class="c1">--创建临时表空间</span>
<span class="k">CREATE</span> <span class="k">TEMPORARY</span> <span class="n">TABLESPACE</span> <span class="n">TEMP</span> 
<span class="n">TEMPFILE</span> <span class="s1">&#39;/u02/oradata/temp.dbf&#39;</span> 
<span class="k">SIZE</span> <span class="mi">50</span><span class="n">m</span> 
<span class="n">AUTOEXTEND</span> <span class="k">ON</span> 
<span class="k">NEXT</span> <span class="mi">50</span><span class="n">m</span> <span class="n">MAXSIZE</span> <span class="mi">20480</span><span class="n">m</span> 
<span class="n">EXTENT</span> <span class="n">MANAGEMENT</span> <span class="k">LOCAL</span><span class="p">;</span>

<span class="c1">--创建单个表空间    </span>
<span class="k">CREATE</span> <span class="n">TABLESPACE</span> <span class="n">TEST</span>                                  <span class="c1">--名称</span>
  <span class="n">DATAFILE</span> <span class="s1">&#39;d:\work\oracle\oradata\test\TEST.DBF&#39;</span>       <span class="c1">--存储位置</span>
  <span class="k">SIZE</span> <span class="mi">2048</span><span class="n">M</span>                                            <span class="c1">--初始大小</span>
  <span class="n">AUTOEXTEND</span> <span class="k">ON</span>                                         <span class="c1">--自动增长</span>
  <span class="k">NEXT</span> <span class="mi">32</span><span class="n">M</span> <span class="n">MAXSIZE</span> <span class="n">UNLIMITED</span>                           <span class="c1">--每次递增32M</span>
  <span class="n">EXTENT</span> <span class="n">MANAGEMENT</span> <span class="k">LOCAL</span><span class="p">;</span>                              <span class="c1">--本地管理</span>

<span class="c1">--创建多个表空间        </span>
<span class="k">CREATE</span> <span class="n">TABLESPACE</span> <span class="n">TS_IMAGEDATA</span>
<span class="n">LOGGING</span>
<span class="n">DATAFILE</span>  <span class="s1">&#39;E:&quot;ORACLE&quot;ORADATA&quot;DATA_01.DBF&#39;</span>  <span class="k">SIZE</span> <span class="mi">2000</span><span class="n">M</span> <span class="n">REUSE</span>    
                <span class="n">AUTOEXTEND</span> <span class="k">ON</span>    
                <span class="k">NEXT</span> <span class="mi">51200</span><span class="n">K</span> <span class="n">MAXSIZE</span> <span class="mi">3900</span><span class="n">M</span><span class="p">,</span>    
          <span class="s1">&#39;E:&quot;ORACLE&quot;ORADATA&quot;XL&quot;DATA_02.DBF&#39;</span>  <span class="k">SIZE</span> <span class="mi">2000</span><span class="n">M</span> <span class="n">REUSE</span>    
                <span class="n">AUTOEXTEND</span> <span class="k">ON</span>    
                <span class="k">NEXT</span> <span class="mi">51200</span><span class="n">K</span> <span class="n">MAXSIZE</span> <span class="mi">3900</span><span class="n">M</span><span class="p">,</span>    
          <span class="s1">&#39;E:&quot;ORACLE&quot;ORADATA&quot;XL&quot;DATA_03.DBF&#39;</span>  <span class="k">SIZE</span> <span class="mi">2000</span><span class="n">M</span> <span class="n">REUSE</span>    
                <span class="n">AUTOEXTEND</span> <span class="k">ON</span>    
                <span class="k">NEXT</span> <span class="mi">51200</span><span class="n">K</span> <span class="n">MAXSIZE</span> <span class="mi">3900</span><span class="n">M</span><span class="p">,</span>    
          <span class="s1">&#39;E:&quot;ORACLE&quot;ORADATA&quot;XL&quot;DATA_04.DBF&#39;</span>  <span class="k">SIZE</span> <span class="mi">2000</span><span class="n">M</span> <span class="n">REUSE</span>    
                <span class="n">AUTOEXTEND</span> <span class="k">ON</span>    
                <span class="k">NEXT</span> <span class="mi">51200</span><span class="n">K</span> <span class="n">MAXSIZE</span> <span class="mi">3900</span><span class="n">M</span>    
<span class="n">EXTENT</span> <span class="n">MANAGEMENT</span> <span class="k">LOCAL</span>    
<span class="n">SEGMENT</span> <span class="k">SPACE</span> <span class="n">MANAGEMENT</span> <span class="n">AUTO</span><span class="p">;</span>

<span class="c1">--创建UNDO表空间       </span>
<span class="k">CREATE</span> <span class="n">UNDO</span> <span class="n">TABLESPACE</span> <span class="n">ts_undo01</span>    
      <span class="n">DATAFILE</span> <span class="s1">&#39;/data/ts_undo01.dbf&#39;</span>      
      <span class="k">SIZE</span> <span class="mi">50000</span><span class="n">M</span> <span class="n">REUSE</span>    
      <span class="n">AUTOEXTEND</span> <span class="k">ON</span><span class="p">;</span>
</pre></div>


<h4 id="_8">建立用户</h4>
<p>在建立用户之前，最好也先查询一下：</p>
<div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="n">username</span> <span class="k">FROM</span> <span class="n">dba_users</span><span class="p">;</span>
</pre></div>


<ul>
<li><a href="http://xlbd.me/query-oracle-users/">查询oracle中所有用户信息</a></li>
</ul>
<p>建立用户当然也要使用有建立用户权限的账户，<a href="https://www.jianshu.com/p/c25dcdbaf797"><strong>语法</strong></a>。</p>
<p><strong>实例</strong>：创建一个名为<code>maxsu</code>的新用户，密码<code>passwd1234</code>，默认表空间为<code>tbs_perm_01</code>，配额为<code>20MB</code>，使用<code>tbs_temp_01</code> 临时表空间。</p>
<div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">USER</span> <span class="n">maxsu</span>
  <span class="n">IDENTIFIED</span> <span class="k">BY</span> <span class="n">passwd1234</span>
  <span class="k">DEFAULT</span> <span class="n">TABLESPACE</span> <span class="n">tbs_perm_01</span>
  <span class="k">TEMPORARY</span> <span class="n">TABLESPACE</span> <span class="n">tbs_temp_01</span>
  <span class="n">QUOTA</span> <span class="mi">20</span><span class="n">M</span> <span class="k">ON</span> <span class="n">tbs_perm_01</span><span class="p">;</span>
</pre></div>


<blockquote>
<p>Oracle12中建立本地用户需要在用户名前加<code>C##</code>，我试用了一下就卸载了。T_T</p>
</blockquote>
<h4 id="_9">授权用户</h4>
<p>当然首先了解下用户权限相关概念，初始化这里的授权一般只是授予用户的系统权限。</p>
<ul>
<li><a href="https://blog.csdn.net/junmail/article/details/4381287">Oracle用户、权限、角色管理</a></li>
</ul>
<p>系统权限分为：</p>
<ul>
<li>DBA：拥有全部特权，是系统最高权限，只有DBA才可以创建数据库结构。（<strong>此权限慎授</strong>）</li>
<li>RESOURCE：拥有Resource权限的用户只可以创建实体，不可以创建数据库结构。</li>
<li>CONNECT：拥有Connect权限的用户只可以登录Oracle，不可以创建实体，不可以创建数据库结构。</li>
</ul>
<blockquote>
<p>系统权限只能由DBA用户授出或收回：sys, system(最开始只能是这两个用户)</p>
<p>普通用户通过授权可以具有与system相同的用户权限，但永远不能达到与sys用户相同的权限，system用户的权限也可以被回收。 </p>
</blockquote>
<p><strong>语法</strong>：</p>
<div class="highlight"><pre><span></span><span class="c1">--系统权限授权</span>
<span class="k">GRANT</span> <span class="k">CONNECT</span><span class="p">,</span> <span class="n">RESOURCE</span><span class="p">,</span> <span class="n">DBA</span> <span class="k">TO</span> <span class="n">user1</span> <span class="p">[,</span><span class="n">user2</span><span class="p">]...;</span>

<span class="c1">--系统权限传递：增加WITH ADMIN OPTION选项，则得到的权限可以传递。</span>
<span class="k">GRANT</span> <span class="k">CONNECT</span><span class="p">,</span> <span class="n">RESOURCE</span> <span class="k">TO</span> <span class="n">user1</span> <span class="k">WITH</span> <span class="k">ADMIN</span> <span class="k">OPTION</span><span class="p">;</span>

<span class="c1">--系统权限回收</span>
<span class="k">REVOKE</span> <span class="k">CONNECT</span><span class="p">,</span> <span class="n">RESOURCE</span> <span class="k">FROM</span> <span class="n">user1</span><span class="p">;</span>
</pre></div>


<h4 id="_10">删除表空间和用户</h4>
<div class="highlight"><pre><span></span><span class="c1">--删除表空间</span>
<span class="k">DROP</span> <span class="n">TABLESPACE</span> <span class="n">tablespace_name</span> <span class="k">INCLUDING</span> <span class="n">CONTENTS</span> <span class="k">AND</span> <span class="n">DATAFILES</span><span class="p">;</span>

<span class="c1">--删除用户：加上CASCADE则将用户连同其创建的东西全部删除</span>
<span class="k">DROP</span> <span class="k">USER</span> <span class="n">user_name</span> <span class="k">CASCADE</span><span class="p">;</span>
</pre></div>


<h2 id="_11">导出/导入数据</h2>
<p><strong>前提</strong>：我们导出/导入数据，肯定是要通过Oracle自带的可执行程序来完成数据的导入导出工作，所以要安装Oracle客户端；同时导出/导入的用户必须要有导出/导入的权限才行。</p>
<p>导出/导入一般有两种方法：</p>
<h4 id="1-cmd">1. 以cmd命令操作符导入导出</h4>
<p>导出/导入的<strong>基本语法</strong>如下：</p>
<div class="highlight"><pre><span></span><span class="n">EXP</span> <span class="k">user</span><span class="o">/</span><span class="n">passwd</span><span class="o">@</span><span class="n">dbname</span> <span class="n">KEYWORD</span><span class="o">=</span><span class="n">value</span><span class="p">...</span>
<span class="n">IMP</span> <span class="k">user</span><span class="o">/</span><span class="n">passwd</span><span class="o">@</span><span class="n">dbname</span> <span class="n">KEYWORD</span><span class="o">=</span><span class="n">value</span><span class="p">...</span>
</pre></div>


<p>具体的<code>KEYWORD</code>可以通过<code>EXP/IMP HELP=Y</code>查看，这里有几个注意事项：</p>
<ul>
<li>
<p><code>@dbname</code>为实例名称，远程服务器一般是<code>@IP/实例名</code>，本地可以省略IP，可以使用别名。</p>
</li>
<li>
<p><code>full=y</code>表示<strong>全库</strong>（是整个数据库）导出/导入（<strong>慎用！</strong>），这个需要有DBA权限的用户，如果只要导出某个用户的所有数据，请不要加上<code>full=y</code>。</p>
</li>
<li>如果导入的表已经存在，直接导入会报错，加上<code>ignore=y</code>，对该表就不进行导入 ；如果是表数据不全，可以删掉该表再加上关键字<code>tables=...</code>重新导入。</li>
<li>如果使用sys账户链接导出某个用户数据，使用<code>exp "'sys/passwd@orcl as SYSDBA'" file=d:\test.dmp owner=ts</code>，注意<code>"'sys/passwd@orcl as SYSDBA'"</code>这里用了两组引号，如果只用一组引号，需要用<code>\</code>转义：<code>exp \"sys/passwd@orcl as SYSDBA\" file=d:\test.dmp owner=ts</code>。</li>
<li>如果使用<code>KEYWORD=(value1,value2,...,valueN)</code>，括号也需要转义：<code>KEYWORD=\(value1,value2,...,valueN\)</code>。</li>
<li>上述2点其实就是括号和引号需要转义。</li>
<li>如果导入的用户和导出的用户不一致，记得加上<code>fromuser</code>和<code>touser</code>。</li>
<li>导出/导入最好最好加上<code>log</code>选项，方便查看过程中遇到的错误，如果有哪张表有问题，可以另外单独处理。最可怕的就是你不知道库没导全。</li>
</ul>
<h4 id="2-plsql-developer">2. 用PL/SQL Developer工具导出/导入</h4>
<p>PL/SQL连上数据库后，也可以进行数据库的导出/导入，但是这里要注意PL/SQL的导出有两部分内容：</p>
<ul>
<li><strong>tools-&gt;export user objects</strong>：导出的.sql文件是建表语句（包括存储结构、函数、包等内容，<strong>不包含表数据</strong>，<strong>不包含dblink</strong>）</li>
<li><strong>tools-&gt;export tables</strong>：导出的是表结构和表数据（<strong>只有表</strong>，不包含其他内容）</li>
</ul>
<blockquote>
<p>注意导出时要选择导出的用户。</p>
<p><strong>所以要完整的导出用户数据，必须将user objects和tables都导出；完整的导入先导入user objects，再导入tables，如果还有dblink，需要手动复制粘贴导入（需要dblink链接的数据库密码）。</strong></p>
</blockquote>
<p>PL/SQL export tables有三种方式：</p>
<ul>
<li>
<p><strong>Oracle导出</strong>：其实就是用Oracle客户端的EXP导出，跟cmd导出指定表是一样的，只是不用输命令，但是这里只能用本地客户端的EXP命令，如果本地Oracle版本和服务器版本不一致，可能会有兼容性问题。</p>
</li>
<li>
<p><strong>SQL插入</strong>：导出的是SQL语句，通用性比较好，方便查看或修改。缺点是日志要全部导出操作完成才能查看，如果表数据量大会有卡死的错觉；而且效率似乎比用EXP低，适合小数据量导入导出。勾选<code>删掉表</code>选项，导入时会在插入表数据前先删掉表，然后重建表插入数据，好处就是如果已存在的表有数据就会直接替换掉。</p>
<blockquote>
<p>如果表包含有CLOB等类型字段的话，是无法导出sql文件的。导出时会有报错提示，可以把这个表单独拿出来用<strong>Oracle导出</strong>。</p>
</blockquote>
</li>
<li>
<p><strong>PL/SQL Developer</strong>：用PL/SQL自带工具导出/导入，导出为.pde格式 ，效率最低（没试过），好处是不需要安装客户端，应该适合少量数据。</p>
</li>
</ul>
<h4 id="_12">总结</h4>
<p>从效率上来说，用EXP/IMP最好，最好的导出/导入方法是在服务器本地导出/导入，这样的好处一是导出/导入的客户端版本和服务器版本一致，不存在兼容性问题（只是单纯的导出或者导入操作不存在兼容性问题，如果导出的服务器和导入的服务器版本不一致，还是有可能有兼容性问题）；二是服务器本地导出速度更快；三是个人电脑关机不影响服务器操作。而且使用EXP/IMP比较方便，一个命令就解决了，但是遇到兼容性问题不太好处理。</p>
<p>从通用性来说，用PL/SQL的SQL插入比较好，而且不容易出现兼容性问题，即使出现了，直接修改SQL语句也比较方便。但是使用PL/SQL容易导不全，需要仔细检查。</p>
<p>如果数据量大的话，建议不要一次性导出/导入，分开导出/导入更安全。</p>
<h4 id="_13">数据导出/导入完整流程</h4>
<ol>
<li><strong>了解</strong>要导出和导入的数据库情况，包括Oracle版本，用户权限，需要导出的数据的大致大小，有无特殊数据类型，有没有依赖其他库的东西，dblink链接密码等，要是能确定具体导哪些表哪些存储过程最好，这样一是导出数据量比较小，二是可以排除其他无效数据的影响；</li>
<li><strong>导出</strong>时对照HELP文档检查导出语句，确保需要配置的KEYWORD都有且正确，记得加上日志选项，导出完毕查看日志，若有报错可能需要单独处理；</li>
<li><strong>导入</strong>时按照上面初始化内容：建立表空间，建立用户并授权，检查导入语句正确无误后开始执行导入，若导入的用户名和导出的用户名不一致，需要加上<code>fromuser</code>和<code>touser</code>；导入完毕查看日志，若有报错可能需要单独处理；</li>
<li><strong>检查</strong>数据是否正确导入，是否有遗漏项；没有问题后编译无效对象，PL/SQL有个按钮直接就能执行，编译完毕后如果仍存在无效对象，检查原库对象是否有效，若是也无效就不用管了（毕竟可能有一些遗留问题），否则需要排查问题；</li>
<li><strong>整理</strong>导出导入过程相关资料，这样下一次重复工作就变得简单了。</li>
</ol>
<h4 id="_14">曾经遇到的问题</h4>
<ul>
<li>
<p>导出报错：数据库链接口令无效</p>
<p>数据库链接指的就是dblink，这个问题只发生在EXP下，一般是导出客户端版本低于服务器端，解决方法一是在服务器本地导出避开兼容性问题；二是另外备份好dblink，删除后再导出，导出后记得恢复。</p>
</li>
<li>
<p>错误使用<code>full=y</code>导出：导入时各种报错</p>
<p>这个只有新手才会犯的错误，搞清楚概念就不会发生了。</p>
</li>
</ul>
<h2 id="oem">OEM创建</h2>
<h4 id="todo">todo</h4>
<p>question 1：oem是个what？</p>
<p>question 2：why should we build oem？</p>
<p>question 3：how to？</p>

      </div><!-- /.entry-content -->
      <div class="comments">
        <h2>Comments</h2>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<div id="gitalk-container"></div>
<script>
	var gitalk_owner = 'jlhxxxx';
	
	var gitalk = new Gitalk({
	  clientID: 'a616e9a93853f37e454b',
	  clientSecret: '38c3bbfaa4dd71957b8824ec071a705ea6fffdfe',
	  repo: 'comments',
	  owner: gitalk_owner,
	  admin: [gitalk_owner],
	  distractionFreeMode: false,  // Facebook-like distraction free mode
	  createIssueManually: true
	})

	gitalk.render('gitalk-container')
</script>
                                  </div>

    </article>
  </section>
</div>
            </div>
        </div>
    </div>

    <footer id="site-footer">
        <div class="row-fluid">
            <div class="span10 offset1">
                <address>
                    <p>
                        This blog is proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                    </p>
                    <p>
                        <a href="http://github.com/jsliang/pelican-fresh/">Fresh</a> is a responsive theme designed by <a href="http://jsliang.com/">jsliang</a> and <a href="https://github.com/jsliang/pelican-fresh/graphs/contributors">contributors</a>.
                        Special thanks to <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a> and <a href="http://getbootstrap.com/">Twitter Bootstrap</a>.
                    </p>
                </address>
            </div>
        </div>
    </footer>

    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-117906599-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
    <script src="//code.jquery.com/jquery.min.js"></script>
    <script src="//netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>
</body>
</html>